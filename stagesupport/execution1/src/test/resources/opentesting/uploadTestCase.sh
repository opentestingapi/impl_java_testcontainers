#! /bin/bash

# define ota server
opentestingserver=http://localhost:50000/
echo ${opentestingserver}

hpath=`pwd`
testname=`basename $@`

for testcase in $@
do
    echo "### ${testcase}:"

    if [ -d "${testcase}" ]; then
        cd ${testcase}

        for f in `ls .`
        do
          if [ ${f} != generated_${testname}.json ] && [ ${f} != generated_test.json ] && [ ${f} != generated_${testname}.yml ] && [ ${f} != generated_test.yml ]; then
            if [ ${f} != ${testname}.json ] && [ ${f} != test.json ] && [ ${f} != ${testname}.yml ] && [ ${f} != test.yml ]; then
              echo "FILE UPLOAD: " ${f}            
              curl -X POST "${opentestingserver}/upload/file/${testname}/${f}" -H "accept: */*" -H "Content-Type: application/json" --data-binary @${f} && echo
            fi
          else
            echo "TEST UPLOAD: " ${f}
            cat ${f} |
            curl -X POST "${opentestingserver}/upload/test" -H "accept: */*" -H "Content-Type: application/json" --data-binary @- && echo
          fi
        done

        cd ${hpath}
    fi
done